%table.state-race-days
  %thead
    %tr
      - for column in columns
        %th{'class': column.html_class}= column.label
  %tbody
    - last_value = nil
    - for race in races
      - current_value = race.send(hide_repeats_column)
      %tr{'class': "#{race.enabled? ? 'enabled' : 'disabled'} #{current_value == last_value ? 'key-repeated' : ''}"}
        - for column in columns
          %td{'class': "#{column.html_class} #{(column.html_class == hide_repeats_column && current_value == last_value) ? 'repeated' : ''}"}
            - case column.html_class
              - when 'date'
                - if race.enabled?
                  %a{href: "/2016/primaries/#{race.race_day_id}"}
                    %time{datetime: race.race_day_id}= format_date(race.date)
                - else
                  %span.disabled
                    %time{datetime: race.race_day_id}= format_date(race.date)
              - when 'state'
                = race.state_name
              - when 'party'
                = race.party_name[0]
              - when 'n-delegates'
                .n-delegates-inner
                  %span.n-delegates-int= format_int(race.n_delegates)
                  %div{'class': "dots dots-#{race.party_id.downcase}"}
                    -# That's a zero-width space (zwsp) between each dot, so they can wrap
                    = "•" * race.n_delegates
        - if !race.enabled?
          %td.disabled-button
        - else
          %td.enabled-button
            %a.results-button{href: "/2016/primaries/#{race.race_day_id}##{race.state_code}-#{race.party_id}"}
              %span.results-button-desktop
                - if race.when_race_happens == 'future'
                  Preview
                - else
                  Results
              »
      - last_value = current_value
