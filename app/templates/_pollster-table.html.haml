.t-pollster
  %h4.party-hed= "#{party.adjective} Candidates"
  %table{'data-party-id': party.id}
    %thead
      %tr
        %th.candidate Candidate
        %th.n-pledged-delegates
          -# "Pledged delegates" doesn't fit on mobile
          .long-table-heading Delegates
        %th.n-delegates
          .long-table-heading Delegates
        %th.pollster National Polls
    %tbody
      - n_unellipsized = 5 # Changing this? Change race-day.js as well, or page will scroll while loading
      - for candidate in party.candidates
        %tr{class: (n_unellipsized <= 0 ? 'ellipsized' : '') + ' ' + (candidate.dropped_out? ? 'dropped-out' : '')}
          %td.candidate
            %img{src: image_path("#{candidate.slug}.png"), alt: ''}
            = candidate.full_name
          %td.n-delegates= candidate.n_delegates || 0
          %td.n-pledged-delegates= candidate.n_pledged_delegates || 0
          %td.pollster
            - if candidate.dropped_out_date
              .dropped-out= "Withdrew #{format_date(candidate.dropped_out_date)}"
            - else
              - if candidate.poll_sparkline && !candidate.poll_sparkline.empty?
                .sparkline!= candidate.poll_sparkline.to_svg
              %span.percent= format_percent_or_nil(candidate.poll_percent)
        - n_unellipsized -= 1

  -# Add prompt, so there's no resize when $.fn.ellipsize_table() kicks in.
  - if n_unellipsized < 0
    .ellipsize-table-prompt

  %p.include-unpledged-delegates
    %label
      %input{type: 'checkbox', name: 'include-unpledged-delegates', checked: true}
      Count unpledged delegates
    %a{href: '/2016/primaries/about-delegates'} More info &raquo;

  .metadata.footnotes
    %p.pollster-note
      Source: AP,
      %a{href: "//elections.huffingtonpost.com/pollster/2016-national-#{{ 'GOP' => 'gop', 'Dem' => 'democratic' }[party.id]}-primary"}
        HuffPost Pollster
