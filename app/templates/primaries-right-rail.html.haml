!!! 5
- preview = true
%html{lang: 'en'}
  %head
    %meta{charset: 'utf-8'}
    %meta{name: 'viewport', content: 'width=device-width, initial-scale=1.0'}
    %title Huffington Post 2016 Primaries Results
    %link{rel: 'stylesheet', href: '/2016/stylesheets/proxima-nova-condensed.css'}
    %link{rel: 'stylesheet', href: asset_path('primaries-right-rail.css')}
  %body.primary-right-rail{class: (preview ? 'future' : 'present'), 'data-race-day-href': "/2016/primaries/#{next_race_day.id}"}
    %div.header
      %div.line
      %div.hed
        -if preview
          %h3= "HAPPENING TODAY: Iowa Caucus"
        -else
          %h3= "HAPPENING NOW: Iowa Caucus"
      %div.line
    %div.container
      - if preview
        %p= "Iowa residents will be the first in the nation to cast their ballots. Check here to see who is leading in the polls and tune in on Feb. 1 for live results."
        %p.tease-link
          %a{target: '_blank', href: "/2016/primaries"} See the election calendar
      - else
        %p= "Results from the first presidential caucuses are coming in."
        %p.tease-link
          %a{target: '_blank', href: "/2016/primaries"} See live-updating results 
          %span.arrow-right
      - parties.each do |party|
        - party_abbrev = party.adjective == 'Democratic' ? "dem" : "gop"
        .party-container
          - del_key = "n_#{party.id.downcase}_delegates"
          %h3{'class': "race-name #{party_abbrev}"}= "#{party.adjective} Caucus"
          %p{class: "#{party.id.downcase}-del-available"}
            Delegates Up For Grabs:
            = state_iowa[del_key]
          %table.t-pollster{'data-party-id': party.id}
            %thead
              %tr
                %th.candidate Candidate
                %th.pollster
                  .long-table-heading Polling Average
                %th.n-votes Votes
            %tbody
              - race = sort_iowa_data(party, state_iowa)
              - race.each do |candidate_state|
                - candidate = candidate_state.candidate
                %tr{'data-candidate-id': candidate.id}
                  %td.candidate
                    %img{src: image_path("#{candidate.slug}.png"), alt: ''}
                    = candidate.full_name
                  %td.pollster
                    - if candidate_state.poll_sparkline && !candidate_state.poll_sparkline.empty?
                      .sparkline!= candidate_state.poll_sparkline.to_svg
                    %span.percent= format_percent_or_nil(candidate_state.poll_percent)
                  %td.n-votes= format_int(candidate_state.n_votes)
          %div.footnotes.footnotes-for-pollster
            %p!= "Polling average based on latest Iowa polls aggregated by <a target=\"_top\" href=\"//elections.huffingtonpost.com/pollster/2016-iowa-presidential-#{party.adjective.downcase}-caucus\">HuffPost Pollster</a>."

  %script{src: '/2016/javascripts/pym.min.js'}
  %script
    var pymChild = new pym.Child();
  %script{src: asset_path('primary-right-rail.js'), async: true}
  %script{src: asset_path('ga.js'), async: true}

