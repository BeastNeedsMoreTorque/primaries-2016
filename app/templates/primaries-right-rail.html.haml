!!! 5
%html{lang: 'en'}
  %head
    %meta{charset: 'utf-8'}
    %meta{name: 'viewport', content: 'width=device-width, initial-scale=1.0'}
    %title Huffington Post 2016 Primaries Results Right Rail
    %link{rel: 'stylesheet', href: '/2016/stylesheets/proxima-nova-condensed.css'}
    %link{rel: 'stylesheet', href: asset_path('primaries-right-rail.css')}
  %body{class: "race-day-#{race_day.when_race_day_happens}"}
    .primary-right-rail
      %div.header
        %div.line
        %div.hed
          %h1.when-present Live Results
          %h1.when-past Results
          %h1.when-future Happening Soon
        %div.line
      %h2
        %a{target: '_blank', href: '/2016/primaries/2016-02-09'}= race_day.title
      .race-day
        %p.intro.when-future= race_day.body
        %p.tease-link.when-future.when-past
          %a{target: '_blank', href: "/2016/primaries#state-race-days-by-date"} See the election calendar
        %p.tease-link.when-present
          %a{target: '_blank', href: "/2016/primaries/#{race_day.id}"} See live updates

        - race_day.races.each do |race|
          .race{id: race.id, 'data-party-id': race.party_id}
            .race-name
              %h3= race.title
              %p
                Delegates: #{race.n_delegates}
            %table.t-pollster
              %thead
                %tr
                  %th.candidate Candidate
                  %th.pollster.when-future
                    .long-table-heading Polling Average
                  %th.n-votes.when-past.when-present Votes
                  %th.n-votes-pct.when-past.when-present %
              %tbody
                - race.candidate_races.each do |candidate_race|
                  - candidate = candidate_race.candidate
                  - is_leader = candidate_race.n_votes > 0 && candidate_race.n_votes == race.candidate_races.first.n_votes
                  %tr{'data-candidate-id': candidate.id, class: "#{is_leader ? 'leader' : ''} #{candidate_race.winner? ? 'winner' : ''}"}
                    %td.candidate
                      %img{src: image_path("#{candidate.slug}.png"), alt: ''}
                      = candidate.full_name
                    %td.pollster.when-future
                      - if candidate_race.poll_sparkline && !candidate_race.poll_sparkline.empty?
                        .sparkline!= candidate_race.poll_sparkline.to_svg
                      %span.percent
                        - if candidate_race.poll_percent.nil?
                          N/A
                        - else
                          = "#{format_percent_or_nil(candidate_race.poll_percent)}%"
                    %td.n-votes.when-past.when-present= format_int(candidate_race.n_votes)
                    %td.n-votes-pct.when-past.when-present= "#{format_percent_or_nil(candidate_race.percent_vote)}"
            %div.footnotes
              %a.footnotes-for-pollster.when-future{target: '_blank', href: "//elections.huffingtonpost.com/pollster/#{race.pollster_slug}"} Source
              %a.footnotes-for-race-day.when-present.when-past{target: '_blank', href: "/2016/primaries/#{race.race_day_id}##{race.state_code}-#{race.party_id}"} Detailed results

  %script{src: '/2016/javascripts/pym.min.js'}
  %script
    var pymChild = new pym.Child();
  %script{src: asset_path('primary-right-rail.js')}
  %script{src: asset_path('ga.js')}
  %script{src: asset_path('stats.js')}


